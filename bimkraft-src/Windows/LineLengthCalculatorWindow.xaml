<Window x:Class="BIMKraft.Windows.LineLengthCalculatorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="BIM Kraft Line Length Calculator"
        Width="1400" Height="800"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <Window.Resources>
        <!-- Styles -->
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C5AA0"/>
        </Style>

        <Style x:Key="SubHeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="Margin" Value="0,3,0,0"/>
        </Style>

        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2C5AA0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1E3A6F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#F5F5F5"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E0E0E0"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SuccessButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#28A745"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#218838"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="15" Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="White" Padding="15" Margin="0,0,0,15"
                BorderBrush="#E0E0E0" BorderThickness="0,0,0,2">
            <StackPanel>
                <TextBlock Text="BIM Kraft Line Length Calculator" Style="{StaticResource HeaderTextStyle}"/>
                <TextBlock Style="{StaticResource SubHeaderTextStyle}">
                    <Run Text="Calculate total length of connected Detail Lines and Model Lines"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Statistics Dashboard -->
        <Border Grid.Row="1" Background="White" Padding="15" Margin="0,0,0,15"
                BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Line Groups" FontSize="11" Foreground="Gray"/>
                        <TextBlock x:Name="TotalGroupsText" Text="0" FontSize="24" FontWeight="Bold" Foreground="#2C5AA0"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Lines" FontSize="11" Foreground="Gray"/>
                        <TextBlock x:Name="TotalLinesText" Text="0" FontSize="24" FontWeight="Bold" Foreground="#FF9800"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Length" FontSize="11" Foreground="Gray"/>
                        <TextBlock x:Name="TotalLengthText" Text="0.00 m" FontSize="24" FontWeight="Bold" Foreground="#4CAF50"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="3" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Detail Lines" FontSize="11" Foreground="Gray"/>
                        <TextBlock x:Name="DetailLinesText" Text="0" FontSize="24" FontWeight="Bold" Foreground="#2196F3"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="4" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Model Lines" FontSize="11" Foreground="Gray"/>
                        <TextBlock x:Name="ModelLinesText" Text="0" FontSize="24" FontWeight="Bold" Foreground="#9C27B0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Control Section -->
        <Border Grid.Row="2" Background="White" Padding="15" Margin="0,0,0,10"
                BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                    <CheckBox x:Name="UseSelectionCheckBox"
                              Content="Use Selected Lines Only"
                              VerticalAlignment="Center"
                              FontWeight="SemiBold"
                              Margin="0,0,15,0"/>
                    <Button Content="Select Lines"
                            Click="SelectLines_Click"
                            Style="{StaticResource SecondaryButtonStyle}"
                            VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Calculate"
                            Click="Calculate_Click"
                            Style="{StaticResource PrimaryButtonStyle}"/>
                    <Button Content="Apply Colors"
                            x:Name="ApplyColorsButton"
                            Click="ApplyColors_Click"
                            Style="{StaticResource SuccessButtonStyle}"
                            IsEnabled="False"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Data Grid Section -->
        <Border Grid.Row="3" Background="White" Padding="10"
                BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Connected Line Groups"
                           FontWeight="SemiBold" FontSize="14" Margin="5,5,5,10"/>

                <DataGrid Grid.Row="1" x:Name="LineGroupsDataGrid"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          SelectionMode="Extended"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          AlternatingRowBackground="#F9F9F9"
                          RowHeight="35"
                          FontSize="12"
                          SelectionChanged="LineGroupsDataGrid_SelectionChanged">
                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="Select" Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                        <DataGridTextColumn Header="Group ID" Binding="{Binding GroupId}" Width="80" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Line Count" Binding="{Binding LineCount}" Width="100" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Total Length" Binding="{Binding TotalLengthFormatted}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Line Style" Binding="{Binding LineStyle}" Width="150" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Line Type" Binding="{Binding LineType}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="View" Binding="{Binding ViewName}" Width="150" IsReadOnly="True"/>
                        <DataGridTemplateColumn Header="Color" Width="150">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Grid.Column="0" Fill="{Binding ColorBrush}"
                                                   Stroke="Black" StrokeThickness="1" Margin="2"/>
                                        <TextBox Grid.Column="1" Text="{Binding ColorHex, UpdateSourceTrigger=PropertyChanged}"
                                                 VerticalContentAlignment="Center" Padding="5,0" Margin="2,0,0,0"/>
                                    </Grid>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Element IDs" Binding="{Binding ElementIdsString}" Width="*" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Footer Section with Export Buttons -->
        <Border Grid.Row="4" Background="White" Padding="15" Margin="0,10,0,0"
                BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Export to Excel"
                        Click="ExportToExcel_Click"
                        Style="{StaticResource SecondaryButtonStyle}"
                        x:Name="ExportExcelButton"
                        IsEnabled="False"/>
                <Button Content="Export to CSV"
                        Click="ExportToCSV_Click"
                        Style="{StaticResource SecondaryButtonStyle}"
                        x:Name="ExportCSVButton"
                        IsEnabled="False"/>
                <Button Content="Copy to Clipboard"
                        Click="CopyToClipboard_Click"
                        Style="{StaticResource SecondaryButtonStyle}"
                        x:Name="CopyButton"
                        IsEnabled="False"/>
                <Button Content="Zoom to Selected"
                        Click="ZoomToSelected_Click"
                        Style="{StaticResource PrimaryButtonStyle}"
                        x:Name="ZoomButton"
                        IsEnabled="False"/>
                <Button Content="Close"
                        Click="Close_Click"
                        Style="{StaticResource SecondaryButtonStyle}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
